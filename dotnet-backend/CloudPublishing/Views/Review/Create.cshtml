@model CloudPublishing.Models.Reviews.ViewModels.CreateReviewModel
@{
    ViewBag.Title = "Создание рецензии";
}

<h2>Создание рецензии</h2>

@using (Html.BeginForm("Create", "Review", FormMethod.Post))
{
    <div class="container mt-5">
        <div class="form-group">
            <div class="row form-group">
                <label class="col-sm-2 col-form-label">Журнал/газета</label>
                @*ajax-запрос по загрузке страницы и заполнение option-ов по аналогии с остальными select?*@
                @Html.DropDownListFor(x => x.publishingList, Model.publishingList, "Выберите элемент" ,htmlAttributes: new { @class = "form-control col-sm-4", id = "publishing" })
            </div>
            <div class="row form-group">
                <label class="col-sm-2 col-form-label">Рубрика</label>
                <select class="form-control col-sm-4" type="text" id="topic"></select>
            </div>
            <div class="row form-group">
                <label class="col-sm-2 col-form-label">Автор</label>
                <select class="form-control col-sm-4" type="text" id="author"></select>
            </div>
            <div class="row form-group">
                <label class="col-sm-2 col-form-label">Статья</label>
                <select class="form-control col-sm-4" type="text" id="article"></select>
            </div>
            <div class="form-group">
                <label class="col-form-label">Содержание</label>
                <textarea class="form-control col-sm-6" rows="6" id="article_content" disabled></textarea>
            </div>
            <div class="form-group">
                <label class="col-form-label">Рецензия</label>
                <textarea class="form-control col-sm-6" rows="6" name="Content" id="review-content"></textarea>
            </div>
            <div class="form-group">
                <div class="form-check">
                    <label class="cursor-pointer">
                        <input class="form-check-input" type="checkbox" value="" name="Approved">В публикацию
                    </label>
                </div>
            </div>
            <div class="row form-group">
                <div class=" "></div>
                <div class="col-sm-6 text-right pr-0">
                    <div class="form-group">
                        <input type="reset" class="btn btn-secondary mr-2" value="Отменить">
                        <input type="submit" class="btn btn-primary" value="Сохранить">
                    </div>
                </div>
            </div>
        </div>
    </div>
}
<script src="~/Scripts/jquery-3.0.0.min.js"></script>
<script>
    $(function () {
        $("#publishing").change(function () {
            var publishingId = $(this).val();
            $.ajax({
                type: "GET",
                url: "@Url.Action("GetTopicList")/" + publishingId,
                success: function (data) {
                    //$("#topic").replaceWith(data);
                    $("#topic *").remove();
                    $("#topic").append(data);
                }
            });
        });
        $("#topic").change(function () {
            var publishingId = $("#publishing").val();
            var topicId = $(this).val();
            $.ajax({
                type: "GET",
                url: "@Url.Action("GetAuthorList")/" + publishingId + "/" + topicId,
                success: function (data) {
                    $("#author *").remove();
                    $("#author").append(data);
                }
            })
        });
        $("#author").change(function () {
            var publishingId = $("#publishing").val();
            var topicId = $("#topic").val();
            var authorId = $(this).val();
            $.ajax({
                type: "GET",
                url: "@Url.Action("GetArticleList")/" + publishingId + "/" + topicId + "/" + authorId,
                success: function (data) {
                    $("#article *").remove();
                    $("#article").append(data);
                    /*$(data).each(function (index, title) {
                        var option = document.createElement('OPTION');
                        option.value = title.id;
                        option.textContent = title.text;
                        $(this).append(option);
                    });*/
                }
            })
        });
    });
</script>